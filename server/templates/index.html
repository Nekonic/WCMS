{% extends "base.html" %}
{% block title %}{{ room or 'ì‹¤ìŠµì‹¤' }} PC ëª©ë¡{% endblock %}
{% block styles %}<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">{% endblock %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5em;">
    <h2 style="margin: 0;">{{ room or 'ì‹¤ìŠµì‹¤' }} PC ëª©ë¡</h2>
    {% if admin %}
    <div style="display: flex; gap: 1em;">
        <button onclick="showDuplicatePCsModal()" style="
            background: #ff9800;
            color: white;
            padding: 0.7em 1.5em;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        " onmouseover="this.style.background='#f57c00'" onmouseout="this.style.background='#ff9800'">
            ğŸ”„ ì¤‘ë³µ PC ê´€ë¦¬
        </button>
        <a href="/layout/editor?room={{ room }}" style="
            background: #4a9eff;
            color: white;
            padding: 0.7em 1.5em;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        " onmouseover="this.style.background='#3a8eef'" onmouseout="this.style.background='#4a9eff'">
            âš™ï¸ ë°°ì¹˜ í¸ì§‘
        </a>
    </div>
    {% endif %}
</div>

<!-- ë²”ë¡€ ë° ì¼ê´„ ëª…ë ¹ ì»¨íŠ¸ë¡¤ -->
<div style="display: flex; gap: 2em; margin-bottom: 2em; padding: 1em; background: #2a2a2a; border-radius: 8px; flex-wrap: wrap; justify-content: space-between; align-items: center;">
    <div style="display: flex; gap: 2em; flex-wrap: wrap;">
        <div style="display: flex; align-items: center; gap: 0.5em;">
            <div style="width: 30px; height: 30px; background: #10b981; border-radius: 4px;"></div>
            <span>ì •ìƒ (CPU < 75%)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5em;">
            <div style="width: 30px; height: 30px; background: #f59e0b; border-radius: 4px;"></div>
            <span>ê²½ê³  (CPU 75~90%)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5em;">
            <div style="width: 30px; height: 30px; background: #dc2626; border-radius: 4px;"></div>
            <span>ìœ„í—˜ (CPU > 90%)</span>
        </div>
        <div style="display: flex; align-items: center; gap: 0.5em;">
            <div style="width: 30px; height: 30px; background: #555; border-radius: 4px;"></div>
            <span>ì˜¤í”„ë¼ì¸</span>
        </div>
    </div>

    {% if admin %}
    <div style="display: flex; gap: 1em; align-items: center;">
        <button onclick="toggleSelectionMode()" id="selectionModeBtn" style="
            background: #6366f1;
            color: white;
            padding: 0.6em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        ">
            ğŸ“‹ ì„ íƒ ëª¨ë“œ
        </button>
        <button onclick="selectAllOnlinePCs()" style="
            background: #8b5cf6;
            color: white;
            padding: 0.6em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        ">
            âœ“ ì˜¨ë¼ì¸ PC ì „ì²´ ì„ íƒ
        </button>
    </div>
    {% endif %}
</div>

<!-- ì„ íƒëœ PC íŒ¨ë„ -->
<div id="selectedPCsPanel" style="display: none; margin-bottom: 1.5em; padding: 1.5em; background: #1e3a8a; border-radius: 8px; border: 2px solid #3b82f6;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em;">
        <h3 style="margin: 0; color: white;">
            <span id="selectedCount">0</span>ëŒ€ ì„ íƒë¨
        </h3>
        <button onclick="clearSelection()" style="
            background: #dc2626;
            color: white;
            padding: 0.5em 1em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        ">
            ì„ íƒ í•´ì œ
        </button>
    </div>

    <div id="selectedPCsList" style="
        display: flex;
        flex-wrap: wrap;
        gap: 0.5em;
        margin-bottom: 1em;
        padding: 1em;
        background: rgba(255,255,255,0.1);
        border-radius: 6px;
        max-height: 150px;
        overflow-y: auto;
    ">
        <!-- ì„ íƒëœ PC ëª©ë¡ ë™ì  ìƒì„± -->
    </div>

    <div style="display: flex; gap: 0.8em; flex-wrap: wrap;">
        <button onclick="showBulkCMDModal()" style="
            background: #10b981;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-terminal"></i> CMD ì‹¤í–‰
        </button>
        <button onclick="showBulkMessageModal()" style="
            background: #2dd4bf;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-comment-dots"></i> ë©”ì‹œì§€ í‘œì‹œ
        </button>
        <button onclick="showBulkKillProcessModal()" style="
            background: #fb7185;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-skull-crossbones"></i> í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
        </button>
        <button onclick="showBulkChocoModal()" style="
            background: #3b82f6;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-download"></i> í”„ë¡œê·¸ë¨ ì„¤ì¹˜
        </button>
        <button onclick="showBulkFileDownloadModal()" style="
            background: #8b5cf6;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-file-download"></i> íŒŒì¼ ë‹¤ìš´ë¡œë“œ
        </button>
        <button onclick="showBulkAccountModal()" style="
            background: #f59e0b;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-user-cog"></i> ê³„ì • ê´€ë¦¬
        </button>
        <button onclick="showBulkPowerModal()" style="
            background: #dc2626;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-power-off"></i> ì „ì› ê´€ë¦¬
        </button>
        <button onclick="clearPendingCommands()" style="
            background: #ff6b6b;
            color: white;
            padding: 0.7em 1.2em;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5em;
        ">
            <i class="fas fa-trash-alt"></i> ëŒ€ê¸° ëª…ë ¹ ì‚­ì œ
        </button>
    </div>
</div>

<!-- ëŒ€ê¸° ì¤‘ì¸ ëª…ë ¹ íŒ¨ë„ -->
<div id="pendingCommandsPanel" style="display: none; margin-bottom: 1.5em; padding: 1.5em; background: #3a3a3a; border-radius: 8px; border: 2px solid #ff6b6b;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1em;">
        <h3 style="margin: 0; color: white;">
            <i class="fas fa-clock"></i> ëŒ€ê¸° ì¤‘ì¸ ëª…ë ¹: <span id="pendingCommandCount">0</span>ê°œ
        </h3>
        <button onclick="closePendingPanel()" style="
            background: transparent;
            color: white;
            border: 1px solid white;
            padding: 0.5em 1em;
            border-radius: 6px;
            cursor: pointer;
        ">
            ë‹«ê¸°
        </button>
    </div>

    <div id="pendingCommandsList" style="
        max-height: 300px;
        overflow-y: auto;
        background: rgba(0,0,0,0.3);
        padding: 1em;
        border-radius: 6px;
    ">
        <!-- ëŒ€ê¸° ëª…ë ¹ ëª©ë¡ ë™ì  ìƒì„± -->
    </div>
</div>

<!-- ì¢Œì„ ë°°ì¹˜ë„ (ê·¸ë¦¬ë“œ) -->
<div style="margin-bottom: 2em; background: #2a2a2a; padding: 2em; border-radius: 10px; width: fit-content;">
    <div id="layoutGrid" style="
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        gap: 0.5em;
        width: fit-content;
    ">
        <!-- JavaScriptì—ì„œ ë™ì  ìƒì„± -->
    </div>
</div>

<!-- ëª…ë ¹ ì‹¤í–‰ ê²°ê³¼ ëª¨ë‹¬ -->
<div id="commandResultModal" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.8);
    z-index: 2000;
    padding: 2em;
    overflow-y: auto;
">
    <div style="
        max-width: 900px;
        margin: 2em auto;
        background: #2a2a2a;
        border-radius: 12px;
        padding: 2em;
    ">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5em;">
            <h2 style="margin: 0; color: white;">
                <i class="fas fa-tasks"></i> ëª…ë ¹ ì‹¤í–‰ ê²°ê³¼
            </h2>
            <button onclick="closeResultModal()" style="
                background: #dc2626;
                color: white;
                border: none;
                padding: 0.6em 1.2em;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 600;
            ">
                ë‹«ê¸°
            </button>
        </div>

        <div id="commandResultStatus" style="
            background: rgba(74, 158, 255, 0.1);
            padding: 1em;
            border-radius: 8px;
            margin-bottom: 1.5em;
            border-left: 4px solid #4a9eff;
        ">
            <div style="display: flex; align-items: center; gap: 1em;">
                <div class="spinner" id="loadingSpinner"></div>
                <div>
                    <div style="color: white; font-weight: 600; margin-bottom: 0.3em;">
                        ëª…ë ¹ ì‹¤í–‰ ì¤‘...
                    </div>
                    <div style="color: #aaa; font-size: 0.9em;">
                        <span id="completedCount">0</span> / <span id="totalCount">0</span> ì™„ë£Œ
                    </div>
                </div>
            </div>
        </div>

        <div id="commandResultList" style="
            max-height: 500px;
            overflow-y: auto;
        ">
            <!-- ê²°ê³¼ ë™ì  ìƒì„± -->
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
const room = "{{ room }}";
const allPCs = {{ pcs|tojson }};
let selectedPCs = new Set();
let selectionMode = false;
let isDragging = false;
let dragStartPos = null;
</script>
<script src="{{ url_for('static', filename='js/pc-grid.js') }}"></script>
<script src="{{ url_for('static', filename='js/commands.js') }}"></script>
{% endblock %}