{% extends "base.html" %}

{% block title %}{{ pc.hostname or 'PC 상세 정보' }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>{{ pc.hostname or 'PC-' + pc.id|string }} 상세 정보</h2>

    {% if pc %}
    <div class="card mt-3">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">기본 정보</h5>
        </div>
        <div class="card-body">
            <table class="table table-bordered">
                <tr>
                    <th width="30%">호스트명</th>
                    <td>{{ pc.hostname or 'N/A' }}</td>
                </tr>
                <tr>
                    <th>실습실</th>
                    <td>{{ pc.room_name or '미배치' }}</td>
                </tr>
                <tr>
                    <th>좌석 번호</th>
                    <td>{{ pc.seat_number or 'N/A' }}</td>
                </tr>
                <tr>
                    <th>IP 주소</th>
                    <td>{{ pc.ip_address or 'N/A' }}</td>
                </tr>
                <tr>
                    <th>MAC 주소</th>
                    <td>{{ pc.mac_address or pc.machine_id or 'N/A' }}</td>
                </tr>
                <tr>
                    <th>온라인 상태</th>
                    <td>
                        {% if pc.is_online %}
                        <span class="badge bg-success">온라인</span>
                        {% else %}
                        <span class="badge bg-secondary">오프라인</span>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">시스템 정보</h5>
        </div>
        <div class="card-body">
            <table class="table table-bordered">
                <tr>
                    <th width="30%">CPU 모델</th>
                    <td>{{ pc.cpu_model or 'N/A' }}</td>
                </tr>
                <tr>
                    <th>CPU 사용률</th>
                    <td>
                        {% if pc.cpu_usage is not none %}
                        {{ pc.cpu_usage }}%
                        {% else %}
                        N/A
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>RAM 전체</th>
                    <td>
                        {% if pc.ram_total %}
                        {{ pc.ram_total }} GB
                        {% else %}
                        N/A
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>RAM 사용</th>
                    <td>
                        {% if pc.ram_used %}
                        {{ pc.ram_used }} GB ({{ pc.ram_usage_percent|round(1) if pc.ram_usage_percent else 'N/A' }}%)
                        {% else %}
                        N/A
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>디스크 정보</th>
                    <td>
                        {% if pc.disk_info_parsed %}
                        <table class="table table-sm table-dark mb-0">
                            <tr><th>디바이스</th><th>총 용량</th><th>파일시스템</th><th>마운트</th></tr>
                            {% for dev, info in pc.disk_info_parsed.items() %}
                            <tr>
                                <td>{{ dev }}</td>
                                <td>{{ info.total_gb }} GB</td>
                                <td>{{ info.fstype or 'N/A' }}</td>
                                <td>{{ info.mountpoint or 'N/A' }}</td>
                            </tr>
                            {% endfor %}
                        </table>
                        {% else %}
                        N/A
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>OS 버전</th>
                    <td>{{ pc.os_edition }} <small class="text-muted">({{ pc.os_version or '버전 정보 없음' }})</small></td>
                </tr>
                <tr>
                    <th>현재 사용자</th>
                    <td>{{ pc.current_user or 'N/A' }}</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="mt-3">
        <button class="btn btn-secondary" onclick="history.back()">돌아가기</button>
        <a href="{{ url_for('pc_history_page', pc_id=pc.id) }}" class="btn btn-info">프로세스 기록 보기</a>

        {% if admin %}
        <button class="btn btn-danger" onclick="sendCommand('shutdown')">종료</button>
        <button class="btn btn-warning" onclick="sendCommand('restart')">재시작</button>
        {% endif %}
    </div>

    {% else %}
    <div class="alert alert-danger mt-3">
        데이터를 불러올 수 없습니다.
    </div>
    {% endif %}
</div>

<script>
function sendCommand(type) {
    if (!confirm(`정말로 ${type === 'shutdown' ? '종료' : '재시작'}하시겠습니까?`)) return;

    fetch('/api/{{ pc.id }}/command', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({type: type, data: {}})
    })
    .then(r => r.json())
    .then(data => {
        alert(data.message || '명령 전송 완료');
    })
    .catch(err => {
        alert('오류 발생: ' + err);
    });
}
</script>
{% endblock %}
