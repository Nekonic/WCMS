# AI μ»¨ν…μ¤νΈ: WCMS ν”„λ΅μ νΈ λΉ λ¥Έ μ¨λ³΄λ”©

> **λ©μ **: AIκ°€ μƒλ΅μ΄ μ„Έμ…μ—μ„ ν”„λ΅μ νΈλ¥Ό λΉ λ¥΄κ² μ΄ν•΄ν•κ³  μ‘μ—…ν•  μ μλ„λ΅ ν•µμ‹¬ μ •λ³΄ μ κ³µ  
> **μ—…λ°μ΄νΈ**: 2026-01-30

---

## π― ν”„λ΅μ νΈ ν•µμ‹¬ κ°λ…

### λ¬΄μ—‡μΈκ°€?
**WCMS (Woosuk Computer Management System)**λ” μ‹¤μµμ‹¤ PCλ¥Ό μ›κ²©μΌλ΅ κ΄€λ¦¬ν•κ³  λ¨λ‹ν„°λ§ν•λ” μ‹μ¤ν…μ…λ‹λ‹¤.

### μ•„ν‚¤ν…μ²
```
ν΄λΌμ΄μ–ΈνΈ (Windows Service) β†β†’ μ„λ²„ (Flask) β†β†’ κ΄€λ¦¬μ (μ›Ή λΈλΌμ°μ €)
```

- **ν΄λΌμ΄μ–ΈνΈ**: Windows μ„λΉ„μ¤λ΅ λ™μ‘, PC μ •λ³΄ μμ§‘ λ° λ…λ Ή μ‹¤ν–‰
- **μ„λ²„**: Flask κΈ°λ°, REST API μ κ³µ, SQLite DB μ‚¬μ©
- **μ›Ή UI**: κ΄€λ¦¬μκ°€ PC μƒνƒ λ¨λ‹ν„°λ§ λ° λ…λ Ή μ „μ†΅

### ν•µμ‹¬ ν†µμ‹  νλ¦„
1. **λ“±λ΅** (μ΄κΈ° 1ν): ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (`POST /api/client/register`)
2. **ν•νΈλΉ„νΈ** (5λ¶„λ§λ‹¤): ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (`POST /api/client/heartbeat`)
3. **λ…λ Ή ν΄λ§** (10μ΄ Long-polling): ν΄λΌμ΄μ–ΈνΈ β† μ„λ²„ (`GET /api/client/command`)
4. **λ…λ Ή μ „μ†΅**: κ΄€λ¦¬μ β†’ μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ (ν΄λ§ μ‘λ‹µμΌλ΅ μ „λ‹¬)
5. **μΆ…λ£ μ‹ νΈ** (PreShutdown): ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ (`POST /api/client/shutdown`)

---

## π“‚ μ£Όμ” νμΌ λ§µ

### μ„λ²„ (server/)
```
server/
β”β”€β”€ app.py                    # Flask μ•± μ΄κΈ°ν™” λ° μ‹¤ν–‰ (Application Factory)
β”β”€β”€ config.py                 # ν™κ²½λ³„ μ„¤μ • (Development/Production/Test)
β”β”€β”€ models/                   # λ°μ΄ν„° μ ‘κ·Ό λ μ΄μ–΄ (Repository ν¨ν„΄)
β”‚   β”β”€β”€ pc.py                 # PC μ •λ³΄ CRUD
β”‚   β”β”€β”€ command.py            # λ…λ Ή CRUD
β”‚   β””β”€β”€ admin.py              # κ΄€λ¦¬μ μΈμ¦
β”β”€β”€ api/                      # REST API (Flask Blueprint)
β”‚   β”β”€β”€ client.py             # ν΄λΌμ΄μ–ΈνΈ API (/api/client/*)
β”‚   β””β”€β”€ admin.py              # κ΄€λ¦¬μ API (/api/admin/*)
β”β”€β”€ services/                 # λΉ„μ¦λ‹μ¤ λ΅μ§ λ μ΄μ–΄
β”‚   β”β”€β”€ pc_service.py         # PC κ΄€λ¦¬ λ΅μ§ (μ¤ν”„λΌμΈ μ²΄ν¬ λ“±)
β”‚   β””β”€β”€ command_service.py    # λ…λ Ή μ²λ¦¬ λ΅μ§
β”β”€β”€ utils/                    # κ³µν†µ μ ν‹Έλ¦¬ν‹°
β”‚   β”β”€β”€ database.py           # DB μ—°κ²° κ΄€λ¦¬ (DatabaseManager)
β”‚   β”β”€β”€ auth.py               # μΈμ¦/κ¶ν• (require_admin λ°μ½”λ μ΄ν„°)
β”‚   β””β”€β”€ validators.py         # μ…λ ¥ κ²€μ¦
β””β”€β”€ templates/                # Jinja2 ν…ν”λ¦Ώ (μ›Ή UI)
```

### ν΄λΌμ΄μ–ΈνΈ (client/)
```
client/
β”β”€β”€ main.py                   # λ©”μΈ λ΅μ§ (λ“±λ΅, ν•νΈλΉ„νΈ, λ…λ Ή ν΄λ§)
β”β”€β”€ service.py                # Windows μ„λΉ„μ¤ λνΌ (PreShutdown ν•Έλ“¤λ§)
β”β”€β”€ collector.py              # μ‹μ¤ν… μ •λ³΄ μμ§‘ (psutil, WMI)
β”β”€β”€ executor.py               # λ…λ Ή μ‹¤ν–‰ (shutdown, reboot, execute λ“±)
β”β”€β”€ config.py                 # ν΄λΌμ΄μ–ΈνΈ μ„¤μ • (ν™κ²½λ³€μ μ§€μ›)
β”β”€β”€ utils.py                  # λ„¤νΈμ›ν¬ μ¬μ‹λ„, μ ν‹Έλ¦¬ν‹° ν•¨μ
β””β”€β”€ data/
    β””β”€β”€ system_processes.json # ν•„ν„°λ§ν•  μ‹μ¤ν… ν”„λ΅μ„Έμ¤ λ©λ΅
```

### λ¬Έμ„ (docs/)
```
docs/
β”β”€β”€ GETTING_STARTED.md        # μ‹μ‘ κ°€μ΄λ“ (μ„¤μΉ, μ‹¤ν–‰, ν…μ¤νΈ)
β”β”€β”€ ARCHITECTURE.md           # μ‹μ¤ν… μ•„ν‚¤ν…μ² μƒμ„Έ (835μ¤„)
β”β”€β”€ API.md                    # REST API μ „μ²΄ λ…μ„Έ
β”β”€β”€ CHANGELOG.md              # λ²„μ „λ³„ λ³€κ²½μ‚¬ν•­
β”β”€β”€ QUICK_REFERENCE.md        # κ°λ°μ λΉ λ¥Έ μ°Έμ΅°
β”β”€β”€ INDEX.md                  # λ¬Έμ„ λ©λ΅ λ° κ°€μ΄λ“
β”β”€β”€ CLIENT_AUTO_UPDATE.md     # ν΄λΌμ΄μ–ΈνΈ μλ™ μ—…λ°μ΄νΈ κΈ°λ¥
β””β”€β”€ GIT_COMMIT_GUIDE.md       # Git μ»¤λ°‹ μ»¨λ²¤μ…
```

### κΈ°νƒ€
- **manage.py**: ν†µν•© κ΄€λ¦¬ μ¤ν¬λ¦½νΈ (μ„λ²„ μ‹¤ν–‰, ν…μ¤νΈ)
- **plan.md**: PreShutdown κΈ°λ¥ κµ¬ν„ μ™„λ£ λ¬Έμ„
- **client/QUICK_FIX.md**: ν΄λΌμ΄μ–ΈνΈ μ§„λ‹¨ κ°€μ΄λ“

---

## π”§ μΌλ°μ μΈ μ‘μ—… ν¨ν„΄

### 1. μƒλ΅μ΄ API μ—”λ“ν¬μΈνΈ μ¶”κ°€
```python
# 1. server/api/client.py λλ” admin.pyμ— λΌμ°νΈ μ¶”κ°€
@client_bp.route('/new-endpoint', methods=['POST'])
def new_endpoint():
    # μ”μ²­ κ²€μ¦
    data = request.json
    if not data or 'required_field' not in data:
        return jsonify({'status': 'error', 'message': 'Missing field'}), 400
    
    # μ„λΉ„μ¤ λ μ΄μ–΄ νΈμ¶
    result = SomeService.do_something(data)
    
    return jsonify({'status': 'success', 'data': result}), 200

# 2. server/services/μ— λΉ„μ¦λ‹μ¤ λ΅μ§ μ¶”κ°€
# 3. server/models/μ— DB μ ‘κ·Ό λ΅μ§ μ¶”κ°€ (ν•„μ”μ‹)
# 4. docs/API.mdμ— API λ¬Έμ„ μ¶”κ°€
```

### 2. ν΄λΌμ΄μ–ΈνΈμ—μ„ μƒλ΅μ΄ λ…λ Ή νƒ€μ… μ²λ¦¬
```python
# 1. client/executor.pyμ CommandExecutor.execute()μ— case μ¶”κ°€
def execute(self, command_type, data):
    if command_type == 'new_command':
        return self._handle_new_command(data)
    # ...

# 2. ν•Έλ“¤λ¬ λ©”μ„λ“ κµ¬ν„
def _handle_new_command(self, data):
    # λ…λ Ή μ‹¤ν–‰ λ΅μ§
    return "Success"
```

### 3. DB μ¤ν‚¤λ§ λ³€κ²½
```sql
-- 1. λ§μ΄κ·Έλ μ΄μ… SQL μ‘μ„± (server/migrations/ κ¶μ¥)
ALTER TABLE pc_info ADD COLUMN new_field TEXT;

-- 2. server/models/μ—μ„ ν•΄λ‹Ή ν•„λ“ μ‚¬μ©
-- 3. docs/ARCHITECTURE.mdμ DB μ¤ν‚¤λ§ μ—…λ°μ΄νΈ
```

### 4. μ„λ²„ μ‹μ‘ λ° ν…μ¤νΈ
```bash
# μ„λ²„ μ‹¤ν–‰
python manage.py run

# ν…μ¤νΈ μ‹¤ν–‰
python manage.py test

# API ν…μ¤νΈ
curl http://localhost:5050/api/client/version
```

---

## β οΈ μ μ•½μ‚¬ν•­ λ° μ£Όμμ‚¬ν•­

### κΈ°μ μ  μ μ•½
1. **SQLite μ‚¬μ©**: λ™μ‹ μ“°κΈ° μ ν• (WAL λ¨λ“λ΅ μ™„ν™”)
2. **Windows μ „μ© ν΄λΌμ΄μ–ΈνΈ**: pywin32, WMI μμ΅΄μ„±
3. **Long-polling**: μ‹¤μ‹κ°„μ„± μ ν• (10μ΄ μ£ΌκΈ°)
4. **λ‚΄λ¶€ λ„¤νΈμ›ν¬ μ „μ©**: ν΄λΌμ΄μ–ΈνΈ APIλ” μΈμ¦ μ—†μ

### μ„¤κ³„ μ›μΉ™
1. **λ¨λ“ν™”**: λ μ΄μ–΄ λ¶„λ¦¬ (API β†’ Service β†’ Model)
2. **νƒ€μ… νν…**: λ¨λ“  μƒ ν•¨μμ— νƒ€μ… νν… ν•„μ
3. **μ—λ¬ ν•Έλ“¤λ§**: ν΄λΌμ΄μ–ΈνΈλ” μ‹¤ν¨ν•΄λ„ κ³„μ† λ™μ‘ν•΄μ•Ό ν•¨
4. **λ΅κΉ…**: λ¨λ“  μ£Όμ” λ™μ‘μ€ λ΅κ·Έμ— κΈ°λ΅

### μ£Όμν•  μ 
- **λ…λ Ή νƒ€μ„μ•„μ›ƒ**: κΈ°λ³Έ 300μ΄, κΈ΄ μ‘μ—…μ€ λ³„λ„ μ²λ¦¬ ν•„μ”
- **ν•νΈλΉ„νΈ μ£ΌκΈ°**: 5λ¶„, λ„λ¬΄ μ§§μΌλ©΄ μ„λ²„ λ¶€ν• μ¦κ°€
- **PreShutdown νƒ€μ„μ•„μ›ƒ**: 2μ΄, μΆ…λ£λ¥Ό λ°©ν•΄ν•μ§€ μ•λ„λ΅ μ§§κ² μ μ§€
- **μ‹μ¤ν… ν”„λ΅μ„Έμ¤**: client/data/system_processes.jsonμ—μ„ ν•„ν„°λ§

---

## π“ μμ‚¬κ²°μ • κΈ°λ΅ (ADR)

### ADR-001: PreShutdown μ΄λ²¤νΈ μ„ νƒ
**μƒν™©**: ν΄λΌμ΄μ–ΈνΈ μΆ…λ£λ¥Ό μ‹¤μ‹κ°„μΌλ΅ κ°μ§€ν•΄μ•Ό ν•¨  
**κ²°μ •**: PreShutdown μ΄λ²¤νΈ μ‚¬μ© (Shutdown λ€μ‹ )  
**μ΄μ **: μ•μ •μ μΈ μ‹κ°„ ν™•λ³΄ (μµμ† 3μ΄), HTTP μ”μ²­ μ „μ†΅ κ°€λ¥  
**μƒνƒ**: β… κµ¬ν„ μ™„λ£

### ADR-002: Long-polling λ°©μ‹ μ±„νƒ
**μƒν™©**: μ‹¤μ‹κ°„ λ…λ Ή μ „λ‹¬ ν•„μ”  
**κ²°μ •**: 10μ΄ Long-polling μ‚¬μ© (WebSocket λ€μ‹ )  
**μ΄μ **: κµ¬ν„ λ‹¨μμ„±, λ°©ν™”λ²½ νΈν™μ„±, λ‚®μ€ λ³µμ΅λ„  
**Trade-off**: μµλ€ 10μ΄ μ§€μ—° ν—μ©

### ADR-003: SQLite μ‚¬μ©
**μƒν™©**: λ°μ΄ν„°λ² μ΄μ¤ μ„ νƒ  
**κ²°μ •**: SQLite (WAL λ¨λ“)  
**μ΄μ **: κ²½λ‰, λ³„λ„ μ„λ²„ λ¶ν•„μ”, λΉ λ¥Έ λ°°ν¬  
**μ ν•**: λ€κ·λ¨ λ™μ‹ μ ‘μ† μ‹ PostgreSQL κ³ λ ¤ ν•„μ”

### ADR-004: ν΄λΌμ΄μ–ΈνΈ API λ¬΄μΈμ¦
**μƒν™©**: ν΄λΌμ΄μ–ΈνΈ API λ³΄μ•  
**κ²°μ •**: μΈμ¦ μ—†μ (machine_idλ§ μ‚¬μ©)  
**μ΄μ **: λ‚΄λ¶€ λ„¤νΈμ›ν¬ μ „μ©, κ΄€λ¦¬ λ³µμ΅λ„ κ°μ†  
**μ „μ μ΅°κ±΄**: μ™Έλ¶€ λ„¤νΈμ›ν¬ λ…Έμ¶ κΈμ§€

---

## π€ λΉ λ¥Έ μ‹μ‘ μ²΄ν¬λ¦¬μ¤νΈ

### μƒ μ„Έμ…μ—μ„ ν•΄μ•Ό ν•  μΌ
1. β… `AI_CONTEXT.md` (μ΄ νμΌ) μ½κΈ°
2. β… `docs/ARCHITECTURE.md` ν›‘μ–΄λ³΄κΈ° (μ „μ²΄ κµ¬μ΅° μ΄ν•΄)
3. β… `docs/API.md` μ°Έκ³  (API μ‘μ—… μ‹)
4. β… `manage.py run` (μ„λ²„ μ‹¤ν–‰ ν…μ¤νΈ)
5. β… κ΄€λ ¨ μ½”λ“ νμΌ μ½κΈ° (ν•„μ” μ‹)

### μΌλ°μ μΈ μ§λ¬Έκ³Ό λ‹µλ³€
**Q: μ„λ²„λ” μ–΄λ–»κ² μ‹μ‘ν•λ‚μ”?**  
A: `python manage.py run` (μλ™μΌλ΅ uv μ„¤μΉ λ° μμ΅΄μ„± λ™κΈ°ν™”)

**Q: ν΄λΌμ΄μ–ΈνΈλ” μ–΄λ–»κ² λΉλ“ν•λ‚μ”?**  
A: GitHub Actions μλ™ λΉλ“ (tag: `client-vX.X.X` ν‘Έμ‹ μ‹)

**Q: API λ…μ„Έλ” μ–΄λ”” μλ‚μ”?**  
A: `docs/API.md` (612μ¤„μ μƒμ„Έν• λ…μ„Έμ„)

**Q: ν…μ¤νΈλ” μ–΄λ–»κ² μ‹¤ν–‰ν•λ‚μ”?**  
A: `python manage.py test` (tests/ λ””λ ‰ν† λ¦¬)

**Q: κΈ°μ΅΄ plan.mdλ” μ™„λ£λμ—λ‚μ”?**  
A: λ„¤, PreShutdown κΈ°λ¥μ€ μ΄λ―Έ κµ¬ν„ μ™„λ£λμ—μµλ‹λ‹¤. (plan.md μ°Έκ³ )

---

## π“ λ‹¤μ μ‘μ—… μ‹ μ°Έκ³ 

### μ½”λ“ λ³€κ²½ μ‹
1. νƒ€μ… νν… μ¶”κ°€ (`def func(arg: str) -> bool:`)
2. Docstring μ‘μ„± (ν•¨μ λ©μ  μ„¤λ…)
3. μ—λ¬ ν•Έλ“¤λ§ (try-except, μ μ ν• HTTP μƒνƒ μ½”λ“)
4. λ΅κΉ… μ¶”κ°€ (logger.info, logger.error)
5. `get_errors` λ„κµ¬λ΅ κ²€μ¦

### λ¬Έμ„ μ—…λ°μ΄νΈ μ‹
1. `docs/CHANGELOG.md`: λ³€κ²½μ‚¬ν•­ κΈ°λ΅
2. `docs/API.md`: API λ³€κ²½ μ‹ μ—…λ°μ΄νΈ
3. `docs/ARCHITECTURE.md`: κµ¬μ΅° λ³€κ²½ μ‹ μ—…λ°μ΄νΈ
4. `AI_CONTEXT.md`: μ¤‘μ”ν• μμ‚¬κ²°μ • κΈ°λ΅

### λ¬Έμ„ μ‘μ„± κ·μΉ™ (μ¤‘μ”!)
**μ²΄ν¬λ°•μ¤**: `- [x]` μ™„λ£, `- [ ]` λ―Έμ™„λ£ (μ΄λ¨ν‹°μ½ β… β β³ κΈμ§€)  
**μ΄λ¨ν‹°μ½**: μ„Ήμ… ν—¤λ”μ—λ§ μµμ†ν• μ‚¬μ© (`## π“ λ¬Έμ„`)

### Git μ»¤λ°‹ μ‹
- μ»¨λ²¤μ…: `type(scope): message` (μ: `feat(api): add new endpoint`)
- μμ„Έν• λ‚΄μ©μ€ `docs/GIT_COMMIT_GUIDE.md` μ°Έκ³ 

---

**μ΄ λ¬Έμ„λ” AIκ°€ ν”„λ΅μ νΈλ¥Ό λΉ λ¥΄κ² μ΄ν•΄ν•κ³  μ‘μ—…μ„ μ‹μ‘ν•κΈ° μ„ν• μµμ†ν•μ μ •λ³΄λ¥Ό μ κ³µν•©λ‹λ‹¤.**  
**λ” μμ„Έν• λ‚΄μ©μ€ docs/ λ””λ ‰ν† λ¦¬μ κ° λ¬Έμ„λ¥Ό μ°Έκ³ ν•μ„Έμ”.**
